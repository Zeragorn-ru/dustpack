[General]
name=DustPack
PreLaunchCommand=powershell -NoProfile -ExecutionPolicy Bypass -Command "Write-Host '[Updater] start'; $base=(Resolve-Path '..').Path; $api='https://api.github.com/repos/Zeragorn-ru/dustpack/releases/latest'; $hashFile=Join-Path $base 'github-digest.txt'; $zip=Join-Path $base 'temp.zip'; $mc=Join-Path $base 'minecraft'; $removes=Join-Path $mc 'removes.txt'; try { Write-Host '[Updater] checking release'; $r=Invoke-RestMethod -Uri $api -Headers @{ 'User-Agent'='PS' } -TimeoutSec 30; $asset=$r.assets | Where-Object name -eq 'modpack.mrpack'; if(!$asset -or !$asset.digest){ Write-Host '[Updater] no asset or digest'; exit }; $newDigest=$asset.digest; if(Test-Path $hashFile){ if((Get-Content $hashFile -Raw) -eq $newDigest){ Write-Host '[Updater] already up to date'; exit } } Write-Host '[Updater] downloading'; Invoke-WebRequest $asset.browser_download_url -OutFile $zip -UseBasicParsing; Write-Host '[Updater] extracting'; Expand-Archive $zip -DestinationPath $base -Force; if(Test-Path $removes){ Write-Host '[Updater] removing files'; Get-Content $removes | ForEach-Object { if($_ -and (Test-Path (Join-Path $mc $_))){ Remove-Item (Join-Path $mc $_) -Recurse -Force } }; Remove-Item $removes -Force } $newDigest | Out-File $hashFile -NoNewline -Force; Remove-Item $zip -Force; Write-Host '[Updater] update done' } catch { Write-Host '[Updater] skipped (error or offline)' }"
OverrideCommands=true